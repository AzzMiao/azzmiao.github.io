"use strict";(self["webpackChunkpets_vue"]=self["webpackChunkpets_vue"]||[]).push([[463],{8463:function(e,t,n){n.r(t),n.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("div",[t("h3",[e._v("编写百科")])])]),t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{staticClass:"topMargin",attrs:{label:"标题：",prop:"title"}},[t("el-row",[t("el-col",{attrs:{span:10}},[t("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1)],1),t("el-form-item",{staticClass:"topMargin",attrs:{label:"百科类型：",prop:"wikiType"}},[t("el-select",{attrs:{placeholder:"百科类型"},model:{value:e.form.wikiType,callback:function(t){e.$set(e.form,"wikiType",t)},expression:"form.wikiType"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.name,staticStyle:{"line-height":"38px",height:"38px"},attrs:{label:e.label,value:e.name}})})),1)],1),e.isEdit?e._e():t("el-form-item",{staticClass:"topMargin",attrs:{label:"预设模板："}},[[t("el-select",{attrs:{placeholder:"预设模板"},on:{change:function(t){return e.aboutTemplateChange()}},model:{value:e.aboutTemplate,callback:function(t){e.aboutTemplate=t},expression:"aboutTemplate"}},e._l(e.templateOptions,(function(e){return t("el-option",{key:e.name,staticStyle:{"line-height":"38px",height:"38px"},attrs:{label:e.label,value:e.name}})})),1)]],2),t("el-form-item",{staticClass:"topMargin",attrs:{label:"封面：",prop:"cover"}},[t("el-row",[t("el-col",{attrs:{span:10}},[t("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:e.uploadCoverURL,headers:e.headers,"show-file-list":!1,"auto-upload":!0,"before-upload":e.beforeUpload,"on-success":e.handleAvatarSuccess,"on-change":e.handleChange,"on-remove":e.handleRemove}},[e.form.cover?t("el-image",{staticClass:"avatar",staticStyle:{width:"368px"},attrs:{src:e.form.cover,fit:"cover"}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1)],1)],1)],1),t("el-form-item",{staticClass:"topMargin",staticStyle:{width:"800px"},attrs:{label:"描述：",prop:"description"}},[t("el-input",{attrs:{type:"textarea",placeholder:"百科描述",maxlength:"200",rows:5,"show-word-limit":""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{staticClass:"topMargin",attrs:{label:"About："}},[t("el-table",{staticStyle:{width:"600px"},attrs:{data:e.form.about}},[t("el-table-column",{attrs:{label:"属性名称",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-form-item",{attrs:{prop:"about."+n.$index+".name",rules:e.rules.about}},[t("el-input",{model:{value:n.row.name,callback:function(t){e.$set(n.row,"name",t)},expression:"scope.row.name"}})],1)]}}])}),t("el-table-column",{attrs:{label:"属性值",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-form-item",{attrs:{prop:"about."+n.$index+".value",rules:e.rules.about}},[t("el-input",{model:{value:n.row.value,callback:function(t){e.$set(n.row,"value",t)},expression:"scope.row.value"}})],1)]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleDelete(n.$index,n.row)}}},[e._v("删除")])]}}])})],1)],1),t("el-form-item",{staticClass:"topMargin"},[t("el-button",{staticStyle:{"margin-left":"152px"},on:{click:e.addDomain}},[e._v("新增属性")])],1),t("el-form-item",{staticClass:"topMargin",attrs:{label:"Content：",prop:"content"}},[t("el-tiptap",{attrs:{extensions:e.extensions,lang:"zh",placeholder:"请输入文章内容",height:"610"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),t("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[e.isEdit?t("el-form-item",{staticClass:"topMargin"},[t("div",{staticStyle:{"margin-right":"100px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.editArticle}},[e._v("保存修改")]),t("el-button",[e._v("取消")])],1)]):t("el-form-item",{staticClass:"topMargin"},[t("div",{staticStyle:{"margin-right":"100px"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit(!1)}}},[e._v("发布")]),t("el-button",{on:{click:function(t){return e.onSubmit(!0)}}},[e._v("存入草稿")])],1)])],1)],1)],1)},a=[],r=(n(7658),n(3266)),o=n(9343),s=n(2836),l=n(7087),u={name:"WikiWorkspace",components:{"el-tiptap":r.ue},mounted(){this.headers={accessToken:l.Z.getItem("accessToken")},this.uploadCoverURL=o.iS(),this.initData()},data(){return{uploadCoverURL:"",headers:{},file:null,form:{wikiId:null,title:"",description:"",about:[],content:"",cover:"",wikiType:"",contentType:"HTML"},aboutTemplate:"",contentTemplate:"",templateOptions:[{name:"cat",label:"猫咪百科"},{name:"dog",label:"狗狗百科"},{name:"bird",label:"鸟类百科"},{name:"fish",label:"鱼类百科"},{name:"turtle",label:"龟类百科"},{name:"rabbit",label:"兔类百科"}],typeOptions:[{name:"cat",label:"猫咪百科"},{name:"dog",label:"狗狗百科"},{name:"bird",label:"鸟类百科"},{name:"fish",label:"鱼类百科"},{name:"turtle",label:"龟类百科"},{name:"rabbit",label:"兔类百科"}],isEdit:!1,rules:{title:[{required:!0,message:"请输入百科标题",trigger:"blur"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"}],wikiType:[{required:!0,message:"请选择百科类型",trigger:"change"}],cover:[{required:!0,message:"请上传百科封面",trigger:"blur"}],description:[{required:!0,message:"请输入百科内描述容",trigger:"blur"}],about:[{required:!0,message:"属性值不能为空",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},extensions:[new r.QW,new r.xv,new r.nv,new r.X6({level:5}),new r.d8({bubble:!0}),new r.v6({bubble:!0,menubar:!1}),new r.Tx,new r.Re,new r.HC,new r.DY,new r.GS,new r.dn,new r.Ee({uploadRequest(e){const t=new FormData;return t.append("file",e),o.RB(t).then((e=>e.result.fileUrl))}}),new r.V6,new r.PH,new r.Ai,new r.iA,new r.xD,new r.pj,new r.SC,new r.bo,new r.d9]}},methods:{initData(){console.log(this.$route.params.wikiId),void 0!=this.$route.params.wikiId&&(this.form.wikiId=this.$route.params.wikiId,this.isEdit=!0,s.de(this.form.wikiId).then((e=>{e.success?(this.form=e.result,delete this.form.creator,delete this.form.rateList,delete this.form.wikiState,delete this.form.createTime,delete this.form.collectionCount,this.form.about=JSON.parse(e.result.about),this.form.wikiId=this.$route.params.wikiId):this.$message.error(e.message)}))),s.fW().then((e=>{e.success?this.typeOptions=JSON.parse(e.result):this.$message.error(e.message)})),s.Tx().then((e=>{e.success?(console.log(e.result),this.templateOptions=JSON.parse(e.result)):this.$message.error(e.message)}))},aboutTemplateChange(){""!=this.aboutTemplate&&(console.log(this.aboutTemplate),s.R1(this.aboutTemplate).then((e=>{e.success?(this.$message.success("获取模板成功"),console.log(e.result.aboutTemplate),this.form.about=JSON.parse(e.result.aboutTemplate),this.form.content=e.result.contentTemplate):this.$message.error(e.message)})))},handleDelete(e,t){this.form.about.splice(e,1)},addDomain(){this.form.about.push({name:"",value:""})},beforeUpload(e){const t="image/jpeg"===e.type,n=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 格式!"),n||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&n},handleRemove(e,t){this.file=null,console.info(this.file)},handleChange(e,t){console.info(e),this.file=e},handleAvatarSuccess(e,t){console.info(t),this.file=t;window.URL||window.webkitURL;this.form.cover=e.result.fileUrl,this.$message.success("图片上传成功")},onSubmit(e){this.$refs.ruleForm.validate((async e=>{if(!e)return this.$message.error("请完善百科信息"),!1;s.WL(this.form).then((e=>{e.success?this.$message.success("百科发布成功"):this.$message.error(e.message)}))}))},editArticle(){this.$refs.ruleForm.validate((async e=>{if(!e)return this.$message.error("请完善百科信息"),!1;s.k0(this.form).then((e=>{e.success?this.$message.success("百科保存成功"):this.$message.error(e.message)}))}))},async getChannelsFn(){this.loading=!0,this.loading=!1},async inquireArticleFn(){}},created(){this.getChannelsFn(),this.isEdit&&this.inquireArticleFn()}},c=u,m=n(1001),p=(0,m.Z)(c,i,a,!1,null,null,null),d=p.exports},2836:function(e,t,n){n.d(t,{G:function(){return u},I$:function(){return m},KL:function(){return p},Kx:function(){return c},MI:function(){return b},R1:function(){return o},S8:function(){return d},Tx:function(){return r},Vn:function(){return h},WL:function(){return s},de:function(){return g},fW:function(){return a},k0:function(){return l},v5:function(){return f}});var i=n(3274);function a(){return(0,i.ZP)({url:"/wiki/type-options",method:i.n$.GET,needToken:!1,headers:{"Content-Type":"application/json"}})}function r(){return(0,i.ZP)({url:"/wiki/template-options",method:i.n$.GET,needToken:!1,headers:{"Content-Type":"application/json"}})}function o(e){return(0,i.ZP)({url:`/wiki/template/${e}`,method:i.n$.GET,needToken:!1,headers:{"Content-Type":"application/json"}})}function s(e){return(0,i.ZP)({url:"/wiki/my/publish",method:i.n$.POST,needToken:!0,data:e,headers:{"Content-Type":"application/json"}})}function l(e){return(0,i.ZP)({url:"/wiki/my/edit",method:i.n$.PUT,needToken:!0,data:e,headers:{"Content-Type":"application/json"}})}function u(e){return(0,i.ZP)({url:"/wiki/my/delete",method:i.n$.DELETE,needToken:!0,data:e,headers:{"Content-Type":"application/json"}})}function c(e){return(0,i.ZP)({url:"/wiki/cards",method:i.n$.POST,needToken:!1,data:e,headers:{"Content-Type":"application/json"}})}function m(e){return(0,i.ZP)({url:"/wiki/my/cards",method:i.n$.POST,needToken:!0,data:e,headers:{"Content-Type":"application/json"}})}function p(){return(0,i.ZP)({url:"/wiki/my/collection-list",method:i.n$.GET,needToken:!0,headers:{"Content-Type":"application/json"}})}function d(e){return(0,i.ZP)({url:"/wiki/my/collection",method:i.n$.POST,needToken:!0,params:e,headers:{"Content-Type":"application/json"}})}function h(e){return(0,i.ZP)({url:"/wiki/my/collection",method:i.n$.GET,needToken:!0,params:e,headers:{"Content-Type":"application/json"}})}function f(e){return(0,i.ZP)({url:"/wiki/my/collection",method:i.n$.PUT,needToken:!0,params:e,headers:{"Content-Type":"application/json"}})}function b(e){return(0,i.ZP)({url:"/wiki/my/collection",method:i.n$.DELETE,needToken:!0,params:e,headers:{"Content-Type":"application/json"}})}function g(e){return(0,i.ZP)({url:`/wiki/info/${e}`,method:i.n$.GET,needToken:!1,headers:{"Content-Type":"application/json"}})}}}]);
//# sourceMappingURL=463.5a682db7.js.map